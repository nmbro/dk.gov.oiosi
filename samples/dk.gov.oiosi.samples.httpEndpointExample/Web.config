<?xml version="1.0"?>
<!--
  * The contents of this file are subject to the Mozilla Public
  * License Version 1.1 (the "License"); you may not use this
  * file except in compliance with the License. You may obtain
  * a copy of the License at http://www.mozilla.org/MPL/
  *
  * Software distributed under the License is distributed on an
  * "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either express
  * or implied. See the License for the specific language governing
  * rights and limitations under the License.
  *
  *
  * The Original Code is .NET RASP toolkit.
  *
  * The Initial Developer of the Original Code is Accenture and Avanade.
  * Portions created by Accenture and Avanade are Copyright (C) 2007
  * Danish National IT and Telecom Agency (http://www.itst.dk). 
  * All Rights Reserved.
  *
  * Contributor(s):
  *   Gert Sylvest (gerts@avanade.com)
  *   Patrik Johansson (p.johansson@accenture.com)
  *   Michael Nielsen (michaelni@avanade.com)
  *   Dennis Søgaard (dennis.j.sogaard@accenture.com)
  *   Mikkel Hippe Brun (mhb@itst.dk)
  *   Finn Hartmann Jordal (fhj@itst.dk)
  *   Christian Lanng (chl@itst.dk)
  *
  *
-->
<configuration>
	<!--  Diagnostics. To enable logging, remove the commenting around this section. 
        Saves SOAP messages in a file called Messages.svclog, and internal .Net traces in a file called Traces.svclog
        The log files can be viewed using Microsoft Trace Viewer, which comes with Win SDK for .Net 3 -->
	<system.diagnostics>
		<sources>
			<source name="System.ServiceModel.MessageLogging" switchValue="Verbose,ActivityTracing">
				<listeners>
					<add type="System.Diagnostics.DefaultTraceListener" name="Default">
						<filter type=""/>
					</add>
					<add name="MessageLogging Listener">
						<filter type=""/>
					</add>
				</listeners>
			</source>
			<source name="System.ServiceModel" switchValue="Warning, ActivityTracing" propagateActivity="true">
				<listeners>
					<add type="System.Diagnostics.DefaultTraceListener" name="Default">
						<filter type=""/>
					</add>
					<add name="ServiceModelTraceListener">
						<filter type=""/>
					</add>
				</listeners>
			</source>
		</sources>
		<sharedListeners>
			<add initializeData="Messages.svclog" type="System.Diagnostics.XmlWriterTraceListener, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" name="MessageLogging Listener" traceOutputOptions="LogicalOperationStack, DateTime, Timestamp">
				<filter type=""/>
			</add>
			<add initializeData="Traces.svclog" type="System.Diagnostics.XmlWriterTraceListener, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" name="ServiceModelTraceListener" traceOutputOptions="Timestamp">
				<filter type=""/>
			</add>
		</sharedListeners>
		<trace autoflush="true"/>
	</system.diagnostics>
	<appSettings>
		<!-- 
      This app setting configures the path to the custom RASP configuration file. 
      IF YOU HAVE DEPLOYED THIS ENDPOINT ANYWHERE ELSE THAN C:\inetpub\wwwroot\RaspTestEndpoint
      THE PATH NEEDS TO BE CHANGED
    -->
		<add key="RaspConfigurationFile" value="C:\inetpub\wwwroot\TestService\RaspConfiguration.xml"/>
	</appSettings>
	<system.serviceModel>
		<diagnostics>
			<messageLogging logEntireMessage="true" logMalformedMessages="true" logMessagesAtTransportLevel="true"/>
		</diagnostics>
		<bindings>
			<customBinding>
				<!-- The standard OIOSI RASP HTTP binding-->
				<binding name="OiosiHttpBinding">
					<!-- XML Schema and Schematron validation-->
					<!--<schematronValidation/>
          <schemaValidation/>-->
					<!-- WS-ReliableMessaging -->
					<reliableSession inactivityTimeout="00:10:00" maxRetryCount="8" ordered="true"/>
					<!-- Generates a signature validation proof, added as a property on the reply message -->
					<signatureValidationProof/>
					<!-- WS-Security -->
					<security defaultAlgorithmSuite="Default" authenticationMode="MutualCertificate" requireDerivedKeys="false" securityHeaderLayout="Strict" includeTimestamp="true" messageProtectionOrder="SignBeforeEncrypt" messageSecurityVersion="WSSecurity10WSTrustFebruary2005WSSecureConversationFebruary2005WSSecurityPolicy11BasicSecurityProfile10" requireSignatureConfirmation="false">
						<secureConversationBootstrap/>
					</security>
					<!-- Adds the custom SenderParty/ReceiverPartyIndetifier headers -->
					<partyIdentifierInterceptor/>
					<!-- Encoding -->
					<textMessageEncoding messageVersion="Default" writeEncoding="utf-8"/>
					<!-- HTTP transport -->
					<httpTransport manualAddressing="false"/>
				</binding>
			</customBinding>
		</bindings>
		<!-- Our OiosiOmniEndpoint service-->
		<services>
			<service behaviorConfiguration="certificateBehaviour" name="dk.gov.oiosi.samples.httpEndpointExample.TestService">
				<endpoint binding="customBinding" bindingConfiguration="OiosiHttpBinding" name="OiosiOmniEndpoint" contract="dk.gov.oiosi.communication.service.IServiceContract"/>
			</service>
		</services>
		<!-- Behaviors are used to set certificates used by the services. The certificate used can be found in resources\OiosiTestVOCES.pfx -->
		<behaviors>
			<serviceBehaviors>
				<behavior name="certificateBehaviour" returnUnknownExceptionsAsFaults="true">
					<serviceMetadata httpGetEnabled="true"/>
					<!-- Add sigingin of the custom RASP headers (added by the <partyIdentifierInterceptor/> element 
          found under the binding -->
					<signCustomHeaders>
						<headers>
							<add name="MessageIdentifier" namespace="http://rep.oio.dk/oiosi.ehandel.gov.dk/xml/schemas/2007/09/01/"/>
							<add name="SenderPartyIdentifier" namespace="http://rep.oio.dk/oiosi.ehandel.gov.dk/xml/schemas/2007/09/01/"/>
              <add name="SenderPartyIdentifierType" namespace="http://rep.oio.dk/oiosi.ehandel.gov.dk/xml/schemas/2007/09/01/"/>
              <add name="ReceiverPartyIdentifier" namespace="http://rep.oio.dk/oiosi.ehandel.gov.dk/xml/schemas/2007/09/01/"/>
              <add name="ReceiverPartyIdentifierType" namespace="http://rep.oio.dk/oiosi.ehandel.gov.dk/xml/schemas/2007/09/01/"/>
						</headers>
					</signCustomHeaders>
					<!-- Configure certificate -->
					<serviceCredentials>
						<serviceCertificate storeLocation="LocalMachine" storeName="My" x509FindType="FindBySerialNumber" findValue="40 36 b3 79"/>
						<clientCertificate>
							<authentication certificateValidationMode="ChainTrust" revocationMode="NoCheck"/>
						</clientCertificate>
					</serviceCredentials>
					<serviceThrottling/>
					<serviceAuthorization impersonateCallerForAllOperations="false" principalPermissionMode="None"/>
				</behavior>
			</serviceBehaviors>
		</behaviors>
		<!-- Here the custom RASP extensions of .Net3/WCF are referred to -->
		<extensions>
			<bindingElementExtensions>
				<add name="partyIdentifierInterceptor" type="dk.gov.oiosi.raspProfile.extension.wcf.Interceptor.CustomHeader.ServerPartyIdentifierHeaderBindingExtensionElement, dk.gov.oiosi.raspProfile"/>
				<add name="schematronValidation" type="dk.gov.oiosi.extension.wcf.Interceptor.Validation.Schematron.ServerSchematronValidationBindingExtensionElement, dk.gov.oiosi.library"/>
				<add name="schemaValidation" type="dk.gov.oiosi.extension.wcf.Interceptor.Validation.Schema.ServerSchemaValidationBindingExtensionElement, dk.gov.oiosi.library"/>
				<add name="signatureValidationProof" type="dk.gov.oiosi.extension.wcf.Interceptor.Security.ServerSignatureValidationProofBindingExtensionElement, dk.gov.oiosi.library"/>
			</bindingElementExtensions>
			<behaviorExtensions>
				<add name="signCustomHeaders" type="dk.gov.oiosi.extension.wcf.Behavior.SignCustomHeadersBehaviorExtensionElement, dk.gov.oiosi.library, Version=1.1.0.0, Culture=neutral, PublicKeyToken=null"/>
			</behaviorExtensions>
		</extensions>
	</system.serviceModel>
	<system.web>
		<compilation debug="true"/></system.web></configuration>
